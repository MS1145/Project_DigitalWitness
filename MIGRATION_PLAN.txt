================================================================================
               DIGITAL WITNESS - NEXT.JS MIGRATION IMPLEMENTATION PLAN
                              Complete Project Documentation
================================================================================

Created: 2026-01-29
Version: 1.0
Project: Digital Witness - Bias-aware Retail Security Assistant

================================================================================
                              TABLE OF CONTENTS
================================================================================

1. EXECUTIVE SUMMARY
2. CURRENT ARCHITECTURE OVERVIEW
3. TARGET ARCHITECTURE
4. PROJECT STRUCTURE (RECOMMENDED)
5. IMPLEMENTATION PLAN A-Z
6. API SPECIFICATION
7. DATABASE SCHEMA
8. FRONTEND COMPONENTS
9. DATA STRUCTURES REFERENCE
10. CONFIGURATION REFERENCE
11. DEPLOYMENT GUIDE
12. TIMELINE RECOMMENDATIONS

================================================================================
                           1. EXECUTIVE SUMMARY
================================================================================

CURRENT STATE:
- Monolithic Python application with Streamlit frontend
- File-based JSON persistence
- Single-user, single-machine processing
- 10-step analysis pipeline for shoplifting detection

TARGET STATE:
- Separated architecture: FastAPI backend + Next.js frontend
- PostgreSQL database for persistence
- Multi-user capable with authentication
- Real-time updates via WebSocket
- Cloud-ready for scalable deployment

KEY BENEFITS:
- Better user experience with modern React-based UI
- Scalable backend API
- Proper separation of concerns
- Real-time capabilities
- Production-ready architecture

================================================================================
                      2. CURRENT ARCHITECTURE OVERVIEW
================================================================================

CURRENT PROJECT STRUCTURE:
--------------------------
Project_DigitalWitness/
├── run.py                    # Unified CLI entry point
├── app.py                    # Streamlit web interface (1,548 lines)
├── pages/
│   └── Security_Manager.py   # Security manager dashboard page
├── src/
│   ├── config.py             # Centralized configuration (149 lines)
│   ├── main.py               # Pipeline orchestrator (288 lines)
│   ├── video.py              # Video I/O & clip extraction (159 lines)
│   ├── pose.py               # Pose estimation & ML (279 lines)
│   ├── analysis.py           # Cross-checking & scoring (276 lines)
│   ├── pos.py                # POS data management (258 lines)
│   ├── alerts.py             # Alert management (376 lines)
│   └── training.py           # Model training (234 lines)
├── data/
│   ├── training/
│   │   ├── normal/           # Normal behavior videos
│   │   └── shoplifting/      # Shoplifting behavior videos
│   ├── videos/               # Input videos for analysis
│   └── pos/                  # POS transaction JSON files
├── models/
│   └── behavior_classifier.pkl  # Trained ML model
├── outputs/
│   ├── alerts/               # Alert JSON persistence
│   ├── clips/                # Forensic video clips
│   └── cases/                # Case file JSON
└── requirements.txt


CURRENT 10-STEP ANALYSIS PIPELINE:
----------------------------------
Step 1: Load Video       → VideoLoader → VideoMetadata
Step 2: Pose Estimation  → PoseEstimator (MediaPipe) → 33 landmarks/frame
Step 3: Feature Extract  → FeatureExtractor → 21-dim feature vectors
Step 4: Classification   → BehaviorClassifier (RandomForest) → Behavior predictions
Step 5: Load POS Data    → POSDataLoader → Transactions
Step 6: Cross-Check      → CrossChecker → DiscrepancyReport
Step 7: Intent Score     → IntentScorer → IntentScore (0.0-1.0)
Step 8: Alert Generation → AlertGenerator → Alert (if score >= 0.5)
Step 9: Clip Extraction  → ClipExtractor → Forensic video evidence
Step 10: Build Case      → Case JSON with all evidence


CURRENT DATA FLOW:
------------------
Video File → Pose Detection → Feature Extraction → ML Classification
                                                           ↓
POS Data → Transaction Loading ──────────────────→ Cross-Check
                                                           ↓
                                                   Intent Scoring
                                                           ↓
                                                   Alert Generation
                                                           ↓
                                                   Case File Output


================================================================================
                         3. TARGET ARCHITECTURE
================================================================================

ARCHITECTURE OVERVIEW:
----------------------
┌─────────────────────────────────────────────────────────────────────────────┐
│                              CLIENT (Browser)                                │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │                         NEXT.JS FRONTEND                                ││
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐     ││
│  │  │Dashboard │ │  Upload  │ │  Alerts  │ │ Security │ │ Training │     ││
│  │  │   Page   │ │   Page   │ │   Page   │ │ Manager  │ │   Page   │     ││
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘     ││
│  │                              ↓ REST API + WebSocket                     ││
│  └─────────────────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           BACKEND (Python FastAPI)                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │                            API LAYER                                     ││
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐     ││
│  │  │ /video   │ │ /alerts  │ │  /pos    │ │/training │ │  /auth   │     ││
│  │  │  routes  │ │  routes  │ │  routes  │ │  routes  │ │  routes  │     ││
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘     ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │                          SERVICE LAYER                                   ││
│  │  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐          ││
│  │  │VideoService│ │AlertService│ │ POSService │ │MLService   │          ││
│  │  └────────────┘ └────────────┘ └────────────┘ └────────────┘          ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │                          CORE MODULES                                    ││
│  │  ┌──────┐ ┌──────┐ ┌────────┐ ┌─────┐ ┌────────┐ ┌──────────┐        ││
│  │  │video │ │ pose │ │analysis│ │ pos │ │ alerts │ │ training │        ││
│  │  └──────┘ └──────┘ └────────┘ └─────┘ └────────┘ └──────────┘        ││
│  └─────────────────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                    ┌─────────────────┼─────────────────┐
                    ▼                 ▼                 ▼
             ┌───────────┐    ┌───────────┐    ┌───────────┐
             │PostgreSQL │    │   Redis   │    │   MinIO   │
             │ Database  │    │   Cache   │    │  Storage  │
             └───────────┘    └───────────┘    └───────────┘


COMMUNICATION:
--------------
- REST API: Standard CRUD operations
- WebSocket: Real-time alerts, processing progress
- File Upload: Multipart form data for videos
- Streaming: Server-sent events for long-running tasks


================================================================================
                    4. PROJECT STRUCTURE (RECOMMENDED)
================================================================================

BACKEND PROJECT (Python/FastAPI):
---------------------------------
digital-witness-backend/
├── main.py                       # FastAPI app entry point
├── requirements.txt              # Python dependencies
├── Dockerfile                    # Container configuration
├── docker-compose.yml            # Multi-container setup
├── .env.example                  # Environment variables template
├── alembic/                      # Database migrations
│   ├── versions/
│   └── env.py
├── app/
│   ├── __init__.py
│   ├── config.py                 # Settings & environment config
│   ├── database.py               # Database connection
│   │
│   ├── api/                      # API routes
│   │   ├── __init__.py
│   │   ├── deps.py               # Dependencies (auth, db session)
│   │   ├── v1/
│   │   │   ├── __init__.py
│   │   │   ├── router.py         # Main v1 router
│   │   │   ├── video.py          # Video analysis endpoints
│   │   │   ├── alerts.py         # Alert management endpoints
│   │   │   ├── pos.py            # POS endpoints
│   │   │   ├── training.py       # Training endpoints
│   │   │   ├── auth.py           # Authentication endpoints
│   │   │   └── websocket.py      # WebSocket handlers
│   │   └── health.py             # Health check endpoint
│   │
│   ├── core/                     # Core business logic (from src/)
│   │   ├── __init__.py
│   │   ├── video.py              # VideoLoader, ClipExtractor
│   │   ├── pose.py               # PoseEstimator, FeatureExtractor, Classifier
│   │   ├── analysis.py           # CrossChecker, IntentScorer, AlertGenerator
│   │   ├── pos.py                # POSDataLoader, POSSimulator
│   │   ├── alerts.py             # AlertManager, NotificationService
│   │   └── training.py           # Training pipeline
│   │
│   ├── models/                   # SQLAlchemy ORM models
│   │   ├── __init__.py
│   │   ├── user.py               # User model
│   │   ├── alert.py              # Alert model
│   │   ├── video.py              # Video analysis model
│   │   ├── transaction.py        # POS transaction model
│   │   └── audit.py              # Audit log model
│   │
│   ├── schemas/                  # Pydantic schemas (API contracts)
│   │   ├── __init__.py
│   │   ├── video.py              # Video schemas
│   │   ├── alert.py              # Alert schemas
│   │   ├── pos.py                # POS schemas
│   │   ├── auth.py               # Auth schemas
│   │   └── common.py             # Shared schemas
│   │
│   ├── services/                 # Service layer
│   │   ├── __init__.py
│   │   ├── video_service.py      # Video processing service
│   │   ├── alert_service.py      # Alert management service
│   │   ├── pos_service.py        # POS service
│   │   ├── ml_service.py         # ML model service
│   │   └── notification_service.py
│   │
│   └── utils/                    # Utilities
│       ├── __init__.py
│       ├── storage.py            # File storage (local/S3/MinIO)
│       ├── background_tasks.py   # Celery/background job helpers
│       └── security.py           # Auth utilities
│
├── ml_models/                    # ML model files
│   └── behavior_classifier.pkl
├── data/                         # Data directory (same structure)
│   ├── training/
│   ├── videos/
│   └── pos/
├── uploads/                      # Uploaded files (temporary)
├── outputs/                      # Generated outputs
│   ├── clips/
│   └── cases/
└── tests/
    ├── __init__.py
    ├── conftest.py
    ├── test_api/
    ├── test_core/
    └── test_services/


FRONTEND PROJECT (Next.js):
---------------------------
digital-witness-frontend/
├── package.json
├── next.config.js
├── tsconfig.json
├── tailwind.config.js
├── .env.local.example
├── Dockerfile
├── public/
│   ├── favicon.ico
│   └── images/
├── src/
│   ├── app/                      # Next.js App Router (v13+)
│   │   ├── layout.tsx            # Root layout
│   │   ├── page.tsx              # Home/Dashboard
│   │   ├── globals.css           # Global styles
│   │   ├── dashboard/
│   │   │   └── page.tsx
│   │   ├── upload/
│   │   │   └── page.tsx
│   │   ├── alerts/
│   │   │   ├── page.tsx
│   │   │   └── [id]/
│   │   │       └── page.tsx
│   │   ├── security-manager/
│   │   │   └── page.tsx
│   │   ├── training/
│   │   │   └── page.tsx
│   │   ├── settings/
│   │   │   └── page.tsx
│   │   └── auth/
│   │       ├── login/
│   │       │   └── page.tsx
│   │       └── register/
│   │           └── page.tsx
│   │
│   ├── components/               # Reusable components
│   │   ├── ui/                   # Base UI components (shadcn/ui)
│   │   │   ├── button.tsx
│   │   │   ├── card.tsx
│   │   │   ├── dialog.tsx
│   │   │   ├── input.tsx
│   │   │   ├── table.tsx
│   │   │   └── ...
│   │   ├── layout/
│   │   │   ├── Header.tsx
│   │   │   ├── Sidebar.tsx
│   │   │   ├── Footer.tsx
│   │   │   └── Navigation.tsx
│   │   ├── dashboard/
│   │   │   ├── StatsCard.tsx
│   │   │   ├── AlertsOverview.tsx
│   │   │   ├── RecentActivity.tsx
│   │   │   └── RiskMeter.tsx
│   │   ├── video/
│   │   │   ├── VideoUploader.tsx
│   │   │   ├── VideoPlayer.tsx
│   │   │   ├── ProcessingProgress.tsx
│   │   │   └── ResultsDisplay.tsx
│   │   ├── alerts/
│   │   │   ├── AlertCard.tsx
│   │   │   ├── AlertList.tsx
│   │   │   ├── AlertDetails.tsx
│   │   │   ├── AlertActions.tsx
│   │   │   └── SeverityBadge.tsx
│   │   ├── pos/
│   │   │   ├── POSSimulator.tsx
│   │   │   ├── ProductCatalog.tsx
│   │   │   ├── Cart.tsx
│   │   │   └── TransactionHistory.tsx
│   │   ├── analysis/
│   │   │   ├── BehaviorTimeline.tsx
│   │   │   ├── DiscrepancyTable.tsx
│   │   │   ├── IntentScoreBreakdown.tsx
│   │   │   └── EvidenceViewer.tsx
│   │   └── charts/
│   │       ├── RiskGauge.tsx
│   │       ├── SeverityPieChart.tsx
│   │       └── ActivityLineChart.tsx
│   │
│   ├── hooks/                    # Custom React hooks
│   │   ├── useAuth.ts
│   │   ├── useAlerts.ts
│   │   ├── useWebSocket.ts
│   │   ├── useVideoUpload.ts
│   │   └── useAnalysis.ts
│   │
│   ├── lib/                      # Utility libraries
│   │   ├── api.ts                # API client (axios/fetch)
│   │   ├── websocket.ts          # WebSocket client
│   │   ├── utils.ts              # Helper functions
│   │   └── constants.ts          # Constants
│   │
│   ├── types/                    # TypeScript types
│   │   ├── index.ts
│   │   ├── alert.ts
│   │   ├── video.ts
│   │   ├── pos.ts
│   │   └── api.ts
│   │
│   ├── context/                  # React contexts
│   │   ├── AuthContext.tsx
│   │   ├── ThemeContext.tsx
│   │   └── AlertContext.tsx
│   │
│   └── styles/                   # Additional styles
│       └── components/
│
└── tests/
    ├── components/
    └── hooks/


================================================================================
                        5. IMPLEMENTATION PLAN A-Z
================================================================================

PHASE 1: BACKEND SETUP (Week 1-2)
=================================

Step A: Create Backend Project Structure
----------------------------------------
1. Create new directory: digital-witness-backend/
2. Initialize Python virtual environment
3. Create requirements.txt with dependencies:
   - fastapi>=0.109.0
   - uvicorn[standard]>=0.27.0
   - pydantic>=2.5.0
   - pydantic-settings>=2.1.0
   - sqlalchemy>=2.0.0
   - alembic>=1.13.0
   - asyncpg>=0.29.0
   - python-multipart>=0.0.6
   - python-jose[cryptography]>=3.3.0
   - passlib[bcrypt]>=1.7.4
   - aiofiles>=23.2.0
   - redis>=5.0.0
   - celery>=5.3.0
   - boto3>=1.34.0 (for S3/MinIO)
   - opencv-python-headless>=4.8.0
   - mediapipe>=0.10.0
   - scikit-learn>=1.3.0
   - numpy>=1.26.0
   - joblib>=1.3.0
4. Set up directory structure as shown above

Step B: Configure Database
--------------------------
1. Install PostgreSQL locally or use Docker
2. Create database: digital_witness
3. Create app/database.py:
   - SQLAlchemy async engine setup
   - Session management
   - Base model class
4. Create app/config.py:
   - Pydantic Settings class
   - Environment variable loading
   - Database URL configuration
5. Set up Alembic for migrations:
   - alembic init alembic
   - Configure alembic.ini
   - Create initial migration

Step C: Create Database Models
------------------------------
1. app/models/user.py:
   - id, email, hashed_password, full_name
   - role (admin, operator, viewer)
   - created_at, updated_at
   - is_active, is_verified

2. app/models/video.py:
   - id, filename, original_filename
   - file_path, file_size
   - duration, fps, resolution
   - status (pending, processing, completed, failed)
   - uploaded_by (FK to user)
   - created_at, processed_at

3. app/models/analysis.py:
   - id, video_id (FK)
   - pose_results_path
   - features_path
   - behavior_events (JSONB)
   - intent_score, severity
   - discrepancy_report (JSONB)
   - created_at

4. app/models/alert.py:
   - id, alert_id (unique string)
   - video_id (FK), analysis_id (FK)
   - severity, intent_score
   - status (pending, acknowledged, dismissed, escalated)
   - explanation, discrepancy_summary, behavior_summary
   - created_at, acknowledged_at, acknowledged_by
   - dismissed_at, dismissed_by, dismiss_reason
   - escalated_at, escalated_by, escalate_reason
   - notes (JSONB array)
   - notification_sent, notification_sent_at

5. app/models/transaction.py:
   - id, transaction_id (string)
   - video_id (FK, nullable)
   - items (JSONB)
   - total, payment_method
   - timestamp, created_at

6. app/models/audit.py:
   - id, user_id (FK)
   - action, resource_type, resource_id
   - details (JSONB)
   - ip_address, user_agent
   - created_at

Step D: Create Pydantic Schemas
-------------------------------
1. app/schemas/common.py:
   - BaseResponse, PaginatedResponse
   - ErrorResponse, SuccessResponse

2. app/schemas/auth.py:
   - UserCreate, UserLogin, UserResponse
   - Token, TokenPayload
   - PasswordReset

3. app/schemas/video.py:
   - VideoUpload, VideoResponse
   - VideoMetadata, VideoStatus
   - AnalysisRequest, AnalysisResponse

4. app/schemas/alert.py:
   - AlertBase, AlertCreate, AlertResponse
   - AlertUpdate, AlertNote
   - AlertStatistics, AlertFilter

5. app/schemas/pos.py:
   - Product, TransactionItem
   - Transaction, TransactionCreate
   - POSSession, ScanEvent
   - DiscrepancyReport

6. app/schemas/analysis.py:
   - PoseResult, PoseFeatures
   - BehaviorEvent, IntentScore
   - AnalysisResult

Step E: Migrate Core Modules
----------------------------
1. Copy src/*.py to app/core/
2. Update imports in each module
3. Convert dataclasses to use Pydantic where needed
4. Ensure all file paths use config settings
5. Test each module independently
6. Files to migrate:
   - video.py → app/core/video.py
   - pose.py → app/core/pose.py
   - analysis.py → app/core/analysis.py
   - pos.py → app/core/pos.py
   - alerts.py → app/core/alerts.py
   - training.py → app/core/training.py
   - config.py → app/config.py (merge with FastAPI config)

Step F: Create Service Layer
----------------------------
1. app/services/video_service.py:
   - upload_video(file) -> VideoResponse
   - get_video(video_id) -> VideoResponse
   - list_videos(filters) -> List[VideoResponse]
   - delete_video(video_id) -> bool
   - analyze_video(video_id, pos_data) -> AnalysisResult
   - get_analysis_status(video_id) -> AnalysisStatus
   - get_analysis_results(video_id) -> AnalysisResult

2. app/services/alert_service.py:
   - create_alert(alert_data) -> AlertResponse
   - get_alert(alert_id) -> AlertResponse
   - list_alerts(filters) -> List[AlertResponse]
   - acknowledge_alert(alert_id, user) -> AlertResponse
   - dismiss_alert(alert_id, user, reason) -> AlertResponse
   - escalate_alert(alert_id, user, reason) -> AlertResponse
   - add_note(alert_id, user, note) -> AlertResponse
   - get_statistics() -> AlertStatistics

3. app/services/pos_service.py:
   - get_catalog() -> List[Product]
   - create_transaction(items) -> Transaction
   - get_transactions(video_id) -> List[Transaction]
   - start_session() -> POSSession
   - scan_item(sku, quantity) -> ScanEvent
   - complete_session() -> Transaction

4. app/services/ml_service.py:
   - load_model() -> BehaviorClassifier
   - predict(features) -> List[BehaviorEvent]
   - train_model(data_dir) -> TrainingResult
   - get_model_info() -> ModelInfo

5. app/services/notification_service.py:
   - send_email_alert(alert) -> bool
   - send_webhook(alert, url) -> bool
   - configure_notifications(config) -> bool

Step G: Create API Routes
-------------------------
1. app/api/v1/auth.py:
   POST /auth/register     - Register new user
   POST /auth/login        - Login, get JWT token
   POST /auth/refresh      - Refresh token
   POST /auth/logout       - Invalidate token
   GET  /auth/me           - Get current user
   PUT  /auth/me           - Update current user
   POST /auth/password-reset

2. app/api/v1/video.py:
   POST /videos/upload     - Upload video file
   GET  /videos            - List all videos
   GET  /videos/{id}       - Get video details
   DELETE /videos/{id}     - Delete video
   POST /videos/{id}/analyze - Start analysis
   GET  /videos/{id}/status   - Get analysis status
   GET  /videos/{id}/results  - Get analysis results
   GET  /videos/{id}/clips    - Get evidence clips

3. app/api/v1/alerts.py:
   GET  /alerts            - List alerts (with filters)
   GET  /alerts/pending    - List pending alerts
   GET  /alerts/statistics - Get alert statistics
   GET  /alerts/{id}       - Get alert details
   POST /alerts/{id}/acknowledge - Acknowledge alert
   POST /alerts/{id}/dismiss    - Dismiss alert
   POST /alerts/{id}/escalate   - Escalate alert
   POST /alerts/{id}/notes      - Add note to alert

4. app/api/v1/pos.py:
   GET  /pos/catalog       - Get product catalog
   POST /pos/session/start - Start POS session
   POST /pos/session/scan  - Scan item
   POST /pos/session/complete - Complete transaction
   POST /pos/session/void  - Void session
   GET  /pos/transactions  - Get transaction history

5. app/api/v1/training.py:
   POST /training/start    - Start model training
   GET  /training/status   - Get training status
   GET  /training/metrics  - Get model metrics

6. app/api/v1/websocket.py:
   WS /ws/alerts           - Real-time alert updates
   WS /ws/analysis/{id}    - Analysis progress updates

Step H: Set Up Background Tasks
-------------------------------
1. Install and configure Celery with Redis
2. Create tasks:
   - analyze_video_task(video_id, pos_data)
   - train_model_task(data_dir)
   - send_notification_task(alert_id)
   - cleanup_old_files_task()
3. Configure task queues:
   - default: general tasks
   - analysis: video processing (long-running)
   - notifications: email/webhook sending

Step I: Testing Backend
-----------------------
1. Write unit tests for core modules
2. Write integration tests for API endpoints
3. Test WebSocket connections
4. Test background tasks
5. Load testing with locust/k6


PHASE 2: FRONTEND SETUP (Week 2-3)
==================================

Step J: Create Frontend Project
-------------------------------
1. Create Next.js project:
   npx create-next-app@latest digital-witness-frontend --typescript --tailwind --app
2. Install dependencies:
   npm install @tanstack/react-query axios zustand
   npm install socket.io-client
   npm install react-hook-form @hookform/resolvers zod
   npm install recharts react-chartjs-2 chart.js
   npm install @radix-ui/react-* (or use shadcn/ui)
   npm install lucide-react
   npm install date-fns
   npm install react-dropzone
   npm install react-player
3. Set up shadcn/ui:
   npx shadcn-ui@latest init
   npx shadcn-ui@latest add button card dialog input table...

Step K: Configure API Client
----------------------------
1. src/lib/api.ts:
   - Axios instance with base URL
   - Request/response interceptors
   - Token refresh logic
   - Error handling

2. src/lib/websocket.ts:
   - Socket.io client setup
   - Connection management
   - Event handlers
   - Reconnection logic

3. src/types/index.ts:
   - TypeScript interfaces matching backend schemas
   - Alert, Video, Transaction, etc.

Step L: Create Layout Components
--------------------------------
1. src/components/layout/Header.tsx:
   - Logo, navigation links
   - User menu dropdown
   - Theme toggle
   - Notification bell

2. src/components/layout/Sidebar.tsx:
   - Navigation menu
   - Collapsible sections
   - Active state indicators

3. src/components/layout/Navigation.tsx:
   - Breadcrumbs
   - Page title

4. src/app/layout.tsx:
   - Root layout with providers
   - Header, Sidebar integration

Step M: Create Dashboard Page
-----------------------------
1. src/app/dashboard/page.tsx:
   - Stats overview cards
   - Recent alerts list
   - Activity timeline
   - Quick actions

2. Components needed:
   - StatsCard.tsx (count, trend indicator)
   - AlertsOverview.tsx (pending alerts summary)
   - RecentActivity.tsx (timeline)
   - RiskMeter.tsx (gauge chart)

Step N: Create Video Upload Page
--------------------------------
1. src/app/upload/page.tsx:
   - Video dropzone
   - Upload progress
   - POS data input option
   - Start analysis button

2. Components needed:
   - VideoUploader.tsx (drag-drop zone)
   - ProcessingProgress.tsx (progress bar, stages)
   - POSDataInput.tsx (manual or simulator)

Step O: Create Analysis Results Page
------------------------------------
1. src/app/videos/[id]/page.tsx:
   - Video player with controls
   - Results summary
   - Detailed breakdowns

2. Components needed:
   - VideoPlayer.tsx (with clip navigation)
   - ResultsDisplay.tsx
   - BehaviorTimeline.tsx (interactive timeline)
   - DiscrepancyTable.tsx
   - IntentScoreBreakdown.tsx
   - EvidenceViewer.tsx (clip viewer)

Step P: Create Alerts Pages
---------------------------
1. src/app/alerts/page.tsx:
   - Alert list with filters
   - Sorting, pagination
   - Bulk actions

2. src/app/alerts/[id]/page.tsx:
   - Full alert details
   - Action buttons
   - Notes section
   - Evidence links

3. Components needed:
   - AlertCard.tsx
   - AlertList.tsx
   - AlertDetails.tsx
   - AlertActions.tsx
   - SeverityBadge.tsx
   - AlertNotes.tsx

Step Q: Create Security Manager Page
------------------------------------
1. src/app/security-manager/page.tsx:
   - Pending alerts queue
   - Review workflow
   - Statistics dashboard
   - Quick actions

2. Features:
   - One-click acknowledge
   - Dismiss with reason modal
   - Escalate with reason modal
   - Add note capability

Step R: Create POS Simulator Component
--------------------------------------
1. src/components/pos/POSSimulator.tsx:
   - Product catalog grid
   - Cart display
   - Scan item action
   - Complete transaction

2. Components needed:
   - ProductCatalog.tsx (grid of products)
   - Cart.tsx (current items)
   - TransactionHistory.tsx

Step S: Create Training Page
----------------------------
1. src/app/training/page.tsx:
   - Training data status
   - Start training button
   - Training progress
   - Model metrics display

2. Components needed:
   - TrainingStatus.tsx
   - MetricsDisplay.tsx
   - ConfusionMatrix.tsx
   - FeatureImportance.tsx

Step T: Create Settings Page
----------------------------
1. src/app/settings/page.tsx:
   - User profile settings
   - Notification preferences
   - Theme settings
   - System configuration

Step U: Create Auth Pages
-------------------------
1. src/app/auth/login/page.tsx:
   - Login form
   - Remember me
   - Forgot password link

2. src/app/auth/register/page.tsx:
   - Registration form
   - Terms acceptance

Step V: Implement Real-time Features
------------------------------------
1. WebSocket connection for alerts
2. Processing progress updates
3. Live POS scanning updates
4. Notification toasts


PHASE 3: INTEGRATION & TESTING (Week 3-4)
=========================================

Step W: API Integration
-----------------------
1. Connect all frontend pages to backend APIs
2. Implement error handling
3. Add loading states
4. Handle edge cases
5. Test all workflows end-to-end

Step X: Testing
---------------
1. Frontend component tests with Jest/Vitest
2. E2E tests with Playwright/Cypress
3. API integration tests
4. Performance testing
5. Security testing (auth, CORS, XSS)

Step Y: Documentation
---------------------
1. API documentation with Swagger/OpenAPI
2. Frontend component documentation
3. Deployment guide
4. User manual


PHASE 4: DEPLOYMENT (Week 4)
============================

Step Z: Deployment Setup
------------------------
1. Docker containerization:
   - Backend Dockerfile
   - Frontend Dockerfile
   - docker-compose.yml

2. Environment configuration:
   - Production env variables
   - Secrets management
   - SSL certificates

3. CI/CD pipeline:
   - GitHub Actions / GitLab CI
   - Automated testing
   - Automated deployment

4. Monitoring:
   - Application logging
   - Error tracking (Sentry)
   - Performance monitoring


================================================================================
                          6. API SPECIFICATION
================================================================================

BASE URL: http://localhost:8000/api/v1

AUTHENTICATION:
---------------
All endpoints except /auth/* require Bearer token in Authorization header.

Token format: Authorization: Bearer <jwt_token>


VIDEO ENDPOINTS:
----------------

POST /videos/upload
  Request: multipart/form-data
    - file: video file (required)
    - pos_data: JSON string (optional)
  Response: {
    "id": "uuid",
    "filename": "string",
    "status": "pending",
    "created_at": "datetime"
  }

GET /videos
  Query params: page, limit, status, sort_by, sort_order
  Response: {
    "items": [VideoResponse],
    "total": int,
    "page": int,
    "limit": int
  }

GET /videos/{id}
  Response: VideoResponse

DELETE /videos/{id}
  Response: {"success": true}

POST /videos/{id}/analyze
  Request: {
    "pos_data": TransactionData (optional)
  }
  Response: {
    "task_id": "string",
    "status": "processing"
  }

GET /videos/{id}/status
  Response: {
    "status": "pending|processing|completed|failed",
    "progress": 0-100,
    "current_step": "string",
    "error": "string" (if failed)
  }

GET /videos/{id}/results
  Response: AnalysisResult


ALERT ENDPOINTS:
----------------

GET /alerts
  Query params: status, severity, page, limit, sort_by
  Response: PaginatedResponse[AlertResponse]

GET /alerts/pending
  Response: List[AlertResponse]

GET /alerts/statistics
  Response: {
    "total": int,
    "by_status": {"pending": int, ...},
    "by_severity": {"low": int, ...},
    "average_response_time": float
  }

GET /alerts/{id}
  Response: AlertResponse

POST /alerts/{id}/acknowledge
  Request: {"user": "string"}
  Response: AlertResponse

POST /alerts/{id}/dismiss
  Request: {"user": "string", "reason": "string"}
  Response: AlertResponse

POST /alerts/{id}/escalate
  Request: {"user": "string", "reason": "string"}
  Response: AlertResponse

POST /alerts/{id}/notes
  Request: {"user": "string", "note": "string"}
  Response: AlertResponse


POS ENDPOINTS:
--------------

GET /pos/catalog
  Response: List[Product]

POST /pos/session/start
  Request: {"terminal_id": "string"}
  Response: POSSession

POST /pos/session/scan
  Request: {"sku": "string", "quantity": int}
  Response: ScanEvent

POST /pos/session/complete
  Response: Transaction

POST /pos/session/void
  Response: {"success": true}


TRAINING ENDPOINTS:
-------------------

POST /training/start
  Request: {
    "normal_dir": "string",
    "shoplifting_dir": "string"
  }
  Response: {"task_id": "string", "status": "started"}

GET /training/status
  Response: {
    "status": "idle|training|completed|failed",
    "progress": 0-100,
    "current_step": "string"
  }

GET /training/metrics
  Response: TrainingMetrics


WEBSOCKET ENDPOINTS:
--------------------

WS /ws/alerts
  Events:
    - new_alert: AlertResponse
    - alert_updated: AlertResponse
    - alert_deleted: {"alert_id": "string"}

WS /ws/analysis/{video_id}
  Events:
    - progress: {"step": "string", "progress": 0-100}
    - completed: AnalysisResult
    - error: {"message": "string"}


================================================================================
                          7. DATABASE SCHEMA
================================================================================

-- Users table
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    hashed_password VARCHAR(255) NOT NULL,
    full_name VARCHAR(255),
    role VARCHAR(50) DEFAULT 'operator',
    is_active BOOLEAN DEFAULT true,
    is_verified BOOLEAN DEFAULT false,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Videos table
CREATE TABLE videos (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    filename VARCHAR(255) NOT NULL,
    original_filename VARCHAR(255) NOT NULL,
    file_path VARCHAR(500) NOT NULL,
    file_size BIGINT,
    duration FLOAT,
    fps FLOAT,
    width INT,
    height INT,
    codec VARCHAR(50),
    status VARCHAR(50) DEFAULT 'pending',
    uploaded_by UUID REFERENCES users(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    processed_at TIMESTAMP
);

-- Analyses table
CREATE TABLE analyses (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    video_id UUID REFERENCES videos(id) ON DELETE CASCADE,
    pose_results_path VARCHAR(500),
    features_path VARCHAR(500),
    behavior_events JSONB,
    intent_score FLOAT,
    severity VARCHAR(50),
    score_components JSONB,
    discrepancy_report JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Alerts table
CREATE TABLE alerts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    alert_id VARCHAR(50) UNIQUE NOT NULL,
    video_id UUID REFERENCES videos(id),
    analysis_id UUID REFERENCES analyses(id),
    severity VARCHAR(50) NOT NULL,
    intent_score FLOAT NOT NULL,
    status VARCHAR(50) DEFAULT 'pending',
    explanation TEXT,
    discrepancy_summary TEXT,
    behavior_summary TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    acknowledged_at TIMESTAMP,
    acknowledged_by UUID REFERENCES users(id),
    dismissed_at TIMESTAMP,
    dismissed_by UUID REFERENCES users(id),
    dismiss_reason TEXT,
    escalated_at TIMESTAMP,
    escalated_by UUID REFERENCES users(id),
    escalate_reason TEXT,
    notes JSONB DEFAULT '[]',
    notification_sent BOOLEAN DEFAULT false,
    notification_sent_at TIMESTAMP
);

-- Transactions table
CREATE TABLE transactions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    transaction_id VARCHAR(50) UNIQUE NOT NULL,
    video_id UUID REFERENCES videos(id),
    items JSONB NOT NULL,
    total DECIMAL(10, 2) NOT NULL,
    payment_method VARCHAR(50),
    timestamp TIMESTAMP NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Evidence clips table
CREATE TABLE evidence_clips (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    analysis_id UUID REFERENCES analyses(id) ON DELETE CASCADE,
    file_path VARCHAR(500) NOT NULL,
    start_time FLOAT NOT NULL,
    end_time FLOAT NOT NULL,
    event_time FLOAT NOT NULL,
    event_type VARCHAR(50) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Audit logs table
CREATE TABLE audit_logs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    action VARCHAR(100) NOT NULL,
    resource_type VARCHAR(50),
    resource_id UUID,
    details JSONB,
    ip_address VARCHAR(45),
    user_agent TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Indexes
CREATE INDEX idx_videos_status ON videos(status);
CREATE INDEX idx_videos_uploaded_by ON videos(uploaded_by);
CREATE INDEX idx_alerts_status ON alerts(status);
CREATE INDEX idx_alerts_severity ON alerts(severity);
CREATE INDEX idx_alerts_created_at ON alerts(created_at);
CREATE INDEX idx_audit_logs_user_id ON audit_logs(user_id);
CREATE INDEX idx_audit_logs_created_at ON audit_logs(created_at);


================================================================================
                       8. FRONTEND COMPONENTS TREE
================================================================================

COMPONENT HIERARCHY:
--------------------

App
├── Providers (QueryClient, Auth, Theme, WebSocket)
│
├── Layout
│   ├── Header
│   │   ├── Logo
│   │   ├── Navigation
│   │   ├── NotificationBell
│   │   │   └── NotificationDropdown
│   │   ├── ThemeToggle
│   │   └── UserMenu
│   │       └── UserDropdown
│   │
│   ├── Sidebar
│   │   ├── SidebarNav
│   │   │   └── NavItem[]
│   │   └── SidebarFooter
│   │
│   └── Main Content Area
│
├── Dashboard Page
│   ├── StatsGrid
│   │   └── StatsCard[] (Total Alerts, Pending, etc.)
│   ├── AlertsOverview
│   │   └── MiniAlertCard[]
│   ├── RiskMeter (Gauge Chart)
│   └── RecentActivity
│       └── ActivityItem[]
│
├── Upload Page
│   ├── VideoUploader
│   │   ├── DropZone
│   │   └── UploadProgress
│   ├── POSDataSection
│   │   ├── POSModeToggle (Manual/Simulator)
│   │   ├── ManualPOSInput
│   │   └── POSSimulator
│   │       ├── ProductGrid
│   │       │   └── ProductCard[]
│   │       └── Cart
│   │           └── CartItem[]
│   └── AnalyzeButton
│
├── Analysis Results Page
│   ├── VideoSection
│   │   ├── VideoPlayer
│   │   └── ClipSelector
│   ├── ResultsSummary
│   │   ├── RiskScore
│   │   ├── SeverityBadge
│   │   └── Explanation
│   ├── BehaviorTimeline
│   │   └── TimelineEvent[]
│   ├── ScoreBreakdown
│   │   └── ScoreComponent[]
│   ├── DiscrepancyTable
│   │   └── DiscrepancyRow[]
│   └── EvidenceSection
│       └── EvidenceClip[]
│
├── Alerts Page
│   ├── AlertFilters
│   │   ├── StatusFilter
│   │   ├── SeverityFilter
│   │   └── DateRangeFilter
│   ├── AlertList
│   │   └── AlertCard[]
│   └── Pagination
│
├── Alert Detail Page
│   ├── AlertHeader
│   │   ├── AlertId
│   │   ├── SeverityBadge
│   │   └── StatusBadge
│   ├── AlertActions
│   │   ├── AcknowledgeButton
│   │   ├── DismissButton (→ DismissModal)
│   │   └── EscalateButton (→ EscalateModal)
│   ├── AlertInfo
│   │   ├── IntentScoreDisplay
│   │   ├── DiscrepancySummary
│   │   └── BehaviorSummary
│   ├── EvidenceViewer
│   │   └── VideoPlayer
│   └── NotesSection
│       ├── NotesList
│       │   └── Note[]
│       └── AddNoteForm
│
├── Security Manager Page
│   ├── PendingAlertsQueue
│   │   └── PendingAlertCard[]
│   ├── QuickActions
│   └── StatisticsDashboard
│       ├── AlertsByStatusChart
│       ├── AlertsBySeverityChart
│       └── ResponseTimeChart
│
├── Training Page
│   ├── TrainingDataStatus
│   ├── StartTrainingButton
│   ├── TrainingProgress
│   └── ModelMetrics
│       ├── AccuracyDisplay
│       ├── ConfusionMatrix
│       └── FeatureImportance
│
└── Settings Page
    ├── ProfileSettings
    ├── NotificationSettings
    ├── ThemeSettings
    └── SystemConfig


================================================================================
                      9. DATA STRUCTURES REFERENCE
================================================================================

BACKEND DATA CLASSES (Python):
------------------------------

# Video
@dataclass
class VideoMetadata:
    path: Path
    fps: float
    frame_count: int
    duration: float
    width: int
    height: int
    codec: str

# Pose
@dataclass
class PoseLandmark:
    x: float  # 0-1 normalized
    y: float  # 0-1 normalized
    z: float  # depth
    visibility: float  # confidence

@dataclass
class PoseResult:
    frame_number: int
    timestamp: float
    landmarks: Optional[Dict[str, PoseLandmark]]
    raw_landmarks: Optional[Any]

@dataclass
class PoseFeatures:
    window_start_frame: int
    window_end_frame: int
    window_start_time: float
    window_end_time: float
    features: np.ndarray  # 21-dim
    feature_names: List[str]

# Behavior
@dataclass
class BehaviorEvent:
    behavior_type: str  # normal/pickup/concealment/bypass
    start_time: float
    end_time: float
    start_frame: int
    end_frame: int
    confidence: float
    probabilities: Dict[str, float]

# Analysis
@dataclass
class ProductInteraction:
    sku: str
    timestamp: float
    interaction_type: str
    confidence: float

@dataclass
class DiscrepancyReport:
    missing_from_billing: List[str]
    extra_in_billing: List[str]
    matched_items: List[str]
    total_detected: int
    total_billed: int
    discrepancy_count: int
    match_rate: float

@dataclass
class IntentScore:
    score: float  # 0.0-1.0
    severity: Severity
    components: dict
    explanation: str

# Alert
@dataclass
class Alert:
    alert_id: str
    timestamp: datetime
    severity: Severity
    intent_score: float
    explanation: str
    evidence_clips: List[ExtractedClip]
    discrepancy_summary: str
    behavior_summary: str
    requires_human_review: bool = True

@dataclass
class ManagedAlert:
    alert: Alert
    status: AlertStatus
    created_at: datetime
    acknowledged_at: Optional[datetime]
    acknowledged_by: Optional[str]
    dismissed_at: Optional[datetime]
    dismissed_by: Optional[str]
    dismiss_reason: Optional[str]
    escalated_at: Optional[datetime]
    escalated_by: Optional[str]
    escalate_reason: Optional[str]
    notes: List[AlertNote]
    notification_sent: bool
    notification_sent_at: Optional[datetime]

# POS
@dataclass
class TransactionItem:
    sku: str
    name: str
    quantity: int
    price: float

@dataclass
class Transaction:
    transaction_id: str
    timestamp: datetime
    items: List[TransactionItem]
    total: float
    payment_method: str

@dataclass
class Product:
    sku: str
    name: str
    price: float


FRONTEND TYPES (TypeScript):
----------------------------

// Video
interface VideoMetadata {
  id: string;
  filename: string;
  originalFilename: string;
  duration: number;
  fps: number;
  width: number;
  height: number;
  status: 'pending' | 'processing' | 'completed' | 'failed';
  createdAt: string;
  processedAt?: string;
}

// Analysis
interface AnalysisResult {
  id: string;
  videoId: string;
  intentScore: number;
  severity: Severity;
  scoreComponents: ScoreComponents;
  behaviorEvents: BehaviorEvent[];
  discrepancyReport: DiscrepancyReport;
  createdAt: string;
}

interface BehaviorEvent {
  behaviorType: 'normal' | 'pickup' | 'concealment' | 'bypass';
  startTime: number;
  endTime: number;
  confidence: number;
  probabilities: Record<string, number>;
}

interface ScoreComponents {
  discrepancy: number;
  concealment: number;
  bypass: number;
  duration: number;
}

interface DiscrepancyReport {
  missingFromBilling: string[];
  extraInBilling: string[];
  matchedItems: string[];
  totalDetected: number;
  totalBilled: number;
  discrepancyCount: number;
  matchRate: number;
}

// Alert
type Severity = 'NONE' | 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL';
type AlertStatus = 'pending' | 'acknowledged' | 'dismissed' | 'escalated';

interface Alert {
  id: string;
  alertId: string;
  videoId: string;
  severity: Severity;
  intentScore: number;
  status: AlertStatus;
  explanation: string;
  discrepancySummary: string;
  behaviorSummary: string;
  evidenceClips: EvidenceClip[];
  createdAt: string;
  acknowledgedAt?: string;
  acknowledgedBy?: string;
  dismissedAt?: string;
  dismissedBy?: string;
  dismissReason?: string;
  escalatedAt?: string;
  escalatedBy?: string;
  escalateReason?: string;
  notes: AlertNote[];
  notificationSent: boolean;
}

interface AlertNote {
  timestamp: string;
  user: string;
  note: string;
}

interface EvidenceClip {
  id: string;
  filePath: string;
  startTime: number;
  endTime: number;
  eventTime: number;
  eventType: string;
}

// POS
interface Product {
  sku: string;
  name: string;
  price: number;
}

interface TransactionItem {
  sku: string;
  name: string;
  quantity: number;
  price: number;
}

interface Transaction {
  transactionId: string;
  timestamp: string;
  items: TransactionItem[];
  total: number;
  paymentMethod: string;
}


================================================================================
                      10. CONFIGURATION REFERENCE
================================================================================

BACKEND ENVIRONMENT VARIABLES (.env):
-------------------------------------
# Application
APP_NAME=Digital Witness
APP_ENV=development
DEBUG=true
SECRET_KEY=your-secret-key-here

# Server
HOST=0.0.0.0
PORT=8000
WORKERS=4

# Database
DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/digital_witness

# Redis
REDIS_URL=redis://localhost:6379/0

# Storage
STORAGE_TYPE=local  # local, s3, minio
UPLOAD_DIR=./uploads
OUTPUT_DIR=./outputs
MAX_UPLOAD_SIZE=500000000  # 500MB

# S3/MinIO (if STORAGE_TYPE=s3 or minio)
S3_ENDPOINT=http://localhost:9000
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=minioadmin
S3_BUCKET=digital-witness

# JWT Authentication
JWT_SECRET_KEY=your-jwt-secret
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# Email Notifications
EMAIL_ENABLED=false
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
EMAIL_SENDER=alerts@example.com
EMAIL_PASSWORD=app-password
EMAIL_RECIPIENTS=security@example.com,manager@example.com

# ML Model
MODEL_PATH=./ml_models/behavior_classifier.pkl
POSE_MIN_DETECTION_CONFIDENCE=0.5
POSE_MIN_TRACKING_CONFIDENCE=0.5

# Analysis
SLIDING_WINDOW_SIZE=30
SLIDING_WINDOW_STRIDE=15
ALERT_THRESHOLD=0.5
WEIGHT_DISCREPANCY=0.4
WEIGHT_CONCEALMENT=0.3
WEIGHT_BYPASS=0.2
WEIGHT_DURATION=0.1

# Forensics
CLIP_BUFFER_BEFORE=3.0
CLIP_BUFFER_AFTER=3.0

# CORS
CORS_ORIGINS=http://localhost:3000,http://127.0.0.1:3000


FRONTEND ENVIRONMENT VARIABLES (.env.local):
--------------------------------------------
# API
NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
NEXT_PUBLIC_WS_URL=ws://localhost:8000

# App
NEXT_PUBLIC_APP_NAME=Digital Witness
NEXT_PUBLIC_APP_VERSION=2.0.0


ML CONFIGURATION (from src/config.py):
--------------------------------------
BEHAVIOR_CLASSES = ["normal", "pickup", "concealment", "bypass"]

# Severity thresholds
INTENT_THRESHOLD_LOW = 0.3
INTENT_THRESHOLD_MEDIUM = 0.5
INTENT_THRESHOLD_HIGH = 0.7
INTENT_THRESHOLD_CRITICAL = 0.85

# Feature extraction
SLIDING_WINDOW_SIZE = 30  # frames (~1 sec at 30fps)
SLIDING_WINDOW_STRIDE = 15  # 50% overlap

# Intent scoring weights (must sum to 1.0)
WEIGHT_DISCREPANCY = 0.4
WEIGHT_CONCEALMENT = 0.3
WEIGHT_BYPASS = 0.2
WEIGHT_DURATION = 0.1

# POS Product Catalog
POS_PRODUCT_CATALOG = [
    {"sku": "CHOC001", "name": "Chocolate Bar", "price": 2.99},
    {"sku": "ENRG001", "name": "Energy Drink", "price": 3.49},
    {"sku": "CHIP001", "name": "Potato Chips", "price": 2.49},
    {"sku": "SODA001", "name": "Soda Can", "price": 1.99},
    {"sku": "CAND001", "name": "Candy Pack", "price": 1.49},
    {"sku": "JRKY001", "name": "Beef Jerky", "price": 5.99},
    {"sku": "WTRL001", "name": "Water Bottle", "price": 1.29},
    {"sku": "COOK001", "name": "Cookies", "price": 3.99},
    {"sku": "NUTS001", "name": "Mixed Nuts", "price": 4.49},
    {"sku": "SAND001", "name": "Sandwich", "price": 5.99}
]


================================================================================
                         11. DEPLOYMENT GUIDE
================================================================================

DOCKER DEPLOYMENT:
------------------

# Backend Dockerfile
FROM python:3.11-slim

WORKDIR /app

# Install system dependencies for OpenCV and MediaPipe
RUN apt-get update && apt-get install -y \
    libgl1-mesa-glx \
    libglib2.0-0 \
    libsm6 \
    libxext6 \
    libxrender-dev \
    && rm -rf /var/lib/apt/lists/*

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]


# Frontend Dockerfile
FROM node:20-alpine AS builder

WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

FROM node:20-alpine AS runner
WORKDIR /app
ENV NODE_ENV=production

COPY --from=builder /app/public ./public
COPY --from=builder /app/.next/standalone ./
COPY --from=builder /app/.next/static ./.next/static

EXPOSE 3000
CMD ["node", "server.js"]


# docker-compose.yml
version: '3.8'

services:
  db:
    image: postgres:16-alpine
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: digital_witness
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

  minio:
    image: minio/minio
    command: server /data --console-address ":9001"
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
    volumes:
      - minio_data:/data
    ports:
      - "9000:9000"
      - "9001:9001"

  backend:
    build: ./digital-witness-backend
    environment:
      - DATABASE_URL=postgresql+asyncpg://postgres:postgres@db:5432/digital_witness
      - REDIS_URL=redis://redis:6379/0
      - S3_ENDPOINT=http://minio:9000
    depends_on:
      - db
      - redis
      - minio
    ports:
      - "8000:8000"
    volumes:
      - ./uploads:/app/uploads
      - ./outputs:/app/outputs
      - ./ml_models:/app/ml_models

  celery:
    build: ./digital-witness-backend
    command: celery -A app.celery worker --loglevel=info
    environment:
      - DATABASE_URL=postgresql+asyncpg://postgres:postgres@db:5432/digital_witness
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      - backend
      - redis

  frontend:
    build: ./digital-witness-frontend
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
      - NEXT_PUBLIC_WS_URL=ws://localhost:8000
    ports:
      - "3000:3000"
    depends_on:
      - backend

volumes:
  postgres_data:
  minio_data:


PRODUCTION CHECKLIST:
---------------------
[ ] Set DEBUG=false
[ ] Use strong SECRET_KEY and JWT_SECRET_KEY
[ ] Configure proper CORS_ORIGINS
[ ] Enable HTTPS/TLS
[ ] Set up proper database credentials
[ ] Configure email notifications
[ ] Set up monitoring (Prometheus, Grafana)
[ ] Set up logging aggregation (ELK, Loki)
[ ] Set up error tracking (Sentry)
[ ] Configure backups for database and file storage
[ ] Set up health check endpoints
[ ] Configure rate limiting
[ ] Set up authentication properly
[ ] Review security headers


================================================================================
                      12. TIMELINE RECOMMENDATIONS
================================================================================

ESTIMATED TIMELINE: 4-6 Weeks
-----------------------------

WEEK 1: Backend Foundation
- Day 1-2: Project setup, database configuration
- Day 3-4: Migrate core modules, create models
- Day 5: Create service layer

WEEK 2: Backend API & Frontend Setup
- Day 1-2: Create all API endpoints
- Day 3: Set up WebSocket handlers
- Day 4-5: Create Next.js project, configure API client

WEEK 3: Frontend Development
- Day 1-2: Layout components, dashboard
- Day 3-4: Video upload, analysis results pages
- Day 5: Alerts pages

WEEK 4: Frontend Development (continued)
- Day 1-2: Security manager, POS simulator
- Day 3: Training page, settings
- Day 4-5: Real-time features, polish

WEEK 5: Integration & Testing
- Day 1-2: End-to-end integration testing
- Day 3-4: Bug fixes, performance optimization
- Day 5: Documentation

WEEK 6: Deployment & Launch
- Day 1-2: Docker setup, CI/CD
- Day 3-4: Production deployment
- Day 5: Monitoring, final testing


================================================================================
                              END OF DOCUMENT
================================================================================

Document created for: Digital Witness Project Migration
Author: Claude Code Assistant
Date: 2026-01-29

For questions or clarifications, refer to the original codebase at:
C:\Users\MSI\Music\Project_DigitalWitness\

Original documentation: CLAUDE.md
